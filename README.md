# koteiterm

シンプルなLinuxターミナルエミュレータ

<video src="https://v.nostr.build/D4LjcHjpjYlZ5MPC.mp4" controls></video>

## 概要

koteitermは、X11とXftを使用したC言語製のターミナルエミュレータです。VT100エスケープシーケンス、ANSI 16色、UTF-8/日本語表示、Nerd Fontsアイコンをサポートしています。

## ビルド

### 必要な依存関係

```bash
sudo apt-get install libx11-dev libxft-dev libfontconfig1-dev libfreetype6-dev
```

### ビルド方法

```bash
make
```

## 実行

```bash
./koteiterm
```

## 操作方法

### キーボード操作

**スクロール:**
- `Shift+PageUp` - 上にスクロール（1画面分）
- `Shift+PageDown` - 下にスクロール（1画面分）

**基本操作:**
- 矢印キー - カーソル移動
- `Ctrl+C` - 割り込み
- `Ctrl+D` - EOF（終了）
- `Tab`, `Enter`, `Backspace` - 標準的な動作

### マウス操作

**テキスト選択:**
- 左ボタンドラッグ - テキストを選択
- 選択されたテキストは自動的にPRIMARYクリップボードにコピーされます

**貼り付け:**
- 中ボタンクリック - PRIMARYクリップボードから貼り付け
- 他のアプリケーションで選択したテキストも貼り付け可能

**スクロール:**
- マウスホイール上 - 上にスクロール（3行）
- マウスホイール下 - 下にスクロール（3行）

## 現在サポートしている機能

### 基本機能
- ✅ X11ウィンドウ表示（動的リサイズ対応）
- ✅ PTY作成とシェル起動
- ✅ Xftフォント描画（Nerd Fonts対応）
- ✅ 動的ターミナルバッファ
- ✅ カーソル表示（下線）
- ✅ スクロールバックバッファ（1000行履歴）

### キーボード入力
- ✅ ASCII文字入力
- ✅ Enter、Backspace、Tab、Escape
- ✅ 矢印キー (Up/Down/Left/Right)
- ✅ Home、End、Page Up/Down
- ✅ Insert、Delete

### VT100エスケープシーケンス
- ✅ カーソル移動
  - CUU (ESC[A): カーソルを上に移動
  - CUD (ESC[B): カーソルを下に移動
  - CUF (ESC[C): カーソルを右に移動
  - CUB (ESC[D): カーソルを左に移動
  - CUP (ESC[H): カーソル位置設定
  - CNL/CPL/HPA/VPA: 追加のカーソル制御
- ✅ 画面クリア
  - ED (ESC[J): 画面の一部または全体をクリア
  - EL (ESC[K): 行の一部または全体をクリア
- ✅ SGR（色と文字属性）
  - **256色対応**（前景色・背景色、ESC[38;5;NmとESC[48;5;Nm）
  - ANSI 16色、6x6x6 RGB色空間（216色）、グレースケール（24段階）
  - 太字、イタリック、下線、反転表示
- ✅ 高度な機能（VT100完全互換）
  - **代替スクリーンバッファ** (ESC[?1049h/l, ESC[?47h/l)
  - **スクロール領域設定** (DECSTBM: ESC[r)
  - **カーソル位置保存・復元** (DECSC: ESC 7, DECRC: ESC 8)
  - **カーソル表示/非表示** (ESC[?25h/l)
  - **行の挿入・削除** (IL: ESC[L, DL: ESC[M)
  - **文字の挿入・削除** (ICH: ESC[@, DCH: ESC[P)
  - **デバイス問い合わせ** (DSR: ESC[6n)
  - **スクロールコマンド** (SU: ESC[S, SD: ESC[T)
- ✅ 基本的な制御文字
  - \\n (改行)
  - \\r (キャリッジリターン)
  - \\b (バックスペース)
  - \\t (タブ)

### 文字エンコーディング
- ✅ UTF-8完全対応（1-4バイト）
- ✅ 日本語表示（ひらがな、カタカナ、漢字）
- ✅ 全角文字対応（East Asian Width検出、2セル表示）
- ✅ Nerd Fontsアイコン表示（vim-airline系）

### スクロール機能
- ✅ Shift+PageUp/PageDown（1画面分スクロール）
- ✅ マウスホイール（3行ずつスクロール）
- ✅ スクロールバック履歴（1000行）

### マウス選択とクリップボード
- ✅ マウスドラッグでテキスト選択
- ✅ 選択範囲のハイライト表示（色反転）
- ✅ X11 PRIMARYクリップボードへの自動コピー
- ✅ 中ボタンクリックで貼り付け
- ✅ 他アプリケーションとのクリップボード共有

### フォント
- ✅ デフォルト: HackGen Console NF（日本語+Nerd Fonts統合フォント）
- ✅ 日本語とNerd Fontsアイコンを同一フォントで表示
- ✅ WSL環境でWindowsフォントにアクセス可能
- ✅ fontconfig言語ヒント（`:lang=ja`）で日本語フォント優先

## 既知の制限事項

### 未実装機能
- ❌ TrueColor (24bit RGB) サポート
- ❌ 設定ファイル
- ❌ タブ機能
- ❌ 分割ウィンドウ
- ❌ CLIPBOARD選択（Ctrl+C/Ctrl+V）

## プロジェクト構成

```
koteiterm/
├── src/
│   ├── main.c          # メインエントリポイント
│   ├── display.c/h     # X11ウィンドウ管理
│   ├── pty.c/h         # PTYとシェル管理
│   ├── font.c/h        # フォント描画
│   ├── terminal.c/h    # ターミナルバッファとVT100パーサー
│   └── input.c/h       # キーボード入力処理
├── include/
│   └── koteiterm.h     # 共通ヘッダー
├── Makefile
├── README.md
├── spec.md             # 仕様書（日本語）
├── implement.md        # 実装計画（日本語）
└── current.md          # 現在の作業状況（日本語）
```

## 開発状況

**フェーズ1: MVP** ✅ 完了
- [x] 1.1-1.8: 基本的なターミナル機能

**フェーズ2: 実用機能** (進行中)
- [x] 2.1: ANSI 16色対応
- [x] 2.2: 特殊キー対応
- [x] 2.3: ウィンドウリサイズ対応
- [x] 2.4: スクロールバックバッファ
- [x] 2.5: マウス選択とクリップボード
- [x] 2.6: 256色サポート
- [x] 2.7: VT100完全互換性 ✅
- [ ] 2.8: フェーズ2統合テスト ← **次**

進捗: 7/8 完了 (87.5%)

## テスト

### Nerd Fontsアイコンテスト

```bash
./test_nerd_icons.sh
```

vim-airlineで使用されるPowerline記号やファイルタイプアイコンが正しく表示されることを確認できます。

### 256色テスト

```bash
./test_256colors.sh
```

256色すべて（ANSI 16色、6x6x6 RGB 216色、グレースケール24段階）が正しく表示されることを確認できます。

## ライセンス

MIT License

Copyright (c) 2025 koteitan

詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 免責事項

本ソフトウェアは「現状のまま」提供されており、明示的または黙示的を問わず、いかなる保証も行いません。本ソフトウェアの使用により生じたいかなる損害についても、著作権者および貢献者は一切の責任を負いません。

使用者は本ソフトウェアを自己の責任において使用するものとします。
